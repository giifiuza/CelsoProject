import pymysql as pymysql
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse
from fastapi.encoders import jsonable_encoder
from pymysql import *

conexao = pymysql.connect(
    host="bdprojeto.mariadb.database.azure.com",
    user="abc@bdprojeto",
    password="senai@mange2023",
    database="projeto_rfid"
)

cursor = conexao.cursor()

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"]
)

@app.get("/cadastro")
async def read_users():
    cursor.execute("SELECT * from cadastro")
    cadastro = cursor.fetchall()
    return cadastro

@app.post("/cadastro")
async def create_user(nome: str, id: float):
    sql = "INSERT INTO cadastro(nome, id) values (%s, %f)"
    var = (nome, id)
    cursor.execute(sql, var)
    conexao.commit()
    return {"nome": nome, "id": id}

@app.delete("/cadastro")
async def delete_user(nome: str):
    cursor.execute(f"DELETE FROM cadastro WHERE nome = {nome}")
    conexao.commit()
    return {"mensagem": "Usu√°rio deletado"}
